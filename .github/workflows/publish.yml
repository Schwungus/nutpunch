name: Publish nutpuncher for major platforms

on:
  push:
    tags: ["stable"]

jobs:
  build:
    name: Upload distribution for ${{ matrix.config.fancy-name }}
    runs-on: ${{ matrix.config.os }}
    strategy:
      fail-fast: false
      matrix:
        config:
          # Requires winsock for now...
          #- name: release-linux
          #  fancy-name: Linux
          #  os: ubuntu-latest
          #  bin-ext: ""
          - name: stable-windows
            fancy-name: Windows
            os: windows-latest
            bin-ext: .exe
    steps:
      - name: Checkout
        uses: actions/checkout@v4
      - name: Build
        run: |
          cmake -S . -B build -DCMAKE_BUILD_TYPE=Release
          cmake --build build --target nutpuncher
      - name: Rename binary artifact
        run: |
          cp build/nutpuncher${{ matrix.config.bin-ext }} nutpuncher-${{ matrix.config.name }}${{ matrix.config.bin-ext }}
      - name: Release binary
        uses: softprops/action-gh-release@v2
        with:
          files: nutpuncher-${{ matrix.config.name }}${{ matrix.config.bin-ext }}
